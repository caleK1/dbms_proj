{% extends 'base.html' %}

{% block content %}

	<h1>Compare</h1>

	<br></br>

	<div class="container">
	    <form method="GET" action="{% url 'compare' %}">
	        <div class="form-group row">
		        <div class="col-md-6">
			        <label for="districtCompareSelectCounty">Select County 1</label>
			        <select class="form-control" id="districtCompareSelectCounty" name="districtCompareCounty" onchange="this.form.submit()">
			            	
			            <option value="" {% if not selected_county %} disabled selected{% endif %}>Select a County</option>

			            {% for county in county_list %}
				            <option value="{{ county.county_id }}" {% if selected_county.county_id == county.county_id %}selected{% endif %}>{{ county.county_name }}</option>
			            {% endfor %}
			           </select>
			    </div>

			    <div class="col-md-6">
	                <label for="districtCompareSelectCounty2">Select County 2</label>
	                <select class="form-control" id="districtCompareSelectCounty2" name="districtCompareCounty2" onchange="this.form.submit()">
	                    <option value="" {% if not selected_county2 %} disabled selected{% endif %}>Select a County</option>
	                    {% for county in county_list %}
	                        <option value="{{ county.county_id }}" {% if selected_county2.county_id == county.county_id %}selected{% endif %}>{{ county.county_name }}</option>
	                    {% endfor %}
	                </select>
	            </div>
			</div>

			<div class="form-group row">
	        	<div class="col-md-6">
	            	<label for="districtCompareSelectDistrict">Select District 1</label>
	            	<select class="form-control" id="districtCompareSelectDistrict" name="districtCompareDistrict" onchange="this.form.submit()">
	            		<option value="" {% if not selected_district %}disabled selected{% endif %}>Select a District</option>

	            		{% for district in dist_in_county %}
		            		<option value="{{ district.district_aun }}" {% if selected_district.district_aun == district.district_aun %}selected{% endif %}>{{ district.district_name }}</option>
	            		{% endfor %}
	            	</select>
	        	</div>

	        	<div class="col-md-6">
	                <label for="districtCompareSelectDistrict2">Select District 2</label>
	                <select class="form-control" id="districtCompareSelectDistrict2" name="districtCompareDistrict2" onchange="this.form.submit()">
	                    <option value="" {% if not selected_district2 %}disabled selected{% endif %}>Select a District</option>
	                    {% for district in dist_in_county2 %}
	                        <option value="{{ district.district_aun }}" {% if selected_district2.district_aun == district.district_aun %}selected{% endif %}>{{ district.district_name }}</option>
	                    {% endfor %}
	                </select>
	            </div>
			</div>

			<div class="form-group row">
	        	<div class="col-md-6">
	            	<label for="districtCompareSelectSchool">Select School 1</label>
	            	<select class="form-control" id="districtCompareSelectSchool" name="districtCompareSchool" onchange="this.form.submit()">
	            		<option value="" {% if not selected_school %}disabled selected{% endif %}>Select a School</option>

	            		{% for school in schls_in_dist %}
		            		<option value="{{ school.school_id }}" {% if selected_school.school_id == school.school_id %}selected{% endif %}>{{ school.school_name }}</option>
	            		{% endfor %}
	            	</select>
	        	</div>

	        	<div class="col-md-6">
	                <label for="districtCompareSelectSchool2">Select School 2</label>
	                <select class="form-control" id="districtCompareSelectSchool2" name="districtCompareSchool2" onchange="this.form.submit()">
	                    <option value="" {% if not selected_school2 %}disabled selected{% endif %}>Select a School</option>
	                    {% for school in schls_in_dist2 %}
	                        <option value="{{ school.school_id }}" {% if selected_school2.school_id == school.school_id %}selected{% endif %}>{{ school.school_name }}</option>
	                    {% endfor %}
	                </select>
	            </div>
			</div>

	        <div class="form-group">
	            <label for="categorySelectCompare">Choose Category</label>
	            <select class="form-control" id="categorySelectCompare" name="categoryCompare" onchange="this.form.submit()">
	            	<option value="demographic" {% if selected_cat == 'demographic' %}selected{% endif %}>Demographic</option>
	                <option value="fiscal" {% if selected_cat == 'fiscal' %}selected{% endif %}>Fiscal</option>
	                <option value="enroll_low_income" {% if selected_cat == 'enroll_low_income' %}selected{% endif %}>Enrollment Low Income (School)</option>
	                <option value="pub_school_grad_rates" {% if selected_cat == 'pub_school_grad_rates' %}selected{% endif %}>Public School Graduation Rates (School)</option>
	                <option value="aid_ratio" {% if selected_cat == 'aid_ratio' %}selected{% endif %}>Aid Ratios (District)</option>
	                <option value="personal_income" {% if selected_cat == 'personal_income' %}selected{% endif %}>Personal Income (District)</option>
	            </select>
	        </div>

	        <div class="form-group">
		        <label for="trendAttrSelectCompare">Choose Attribute</label>
		        <select class="form-control" id="trendAttrSelectCompare" name="trendAttrCompare" onchange="this.form.submit()">
		        	<option value="" {% if not selected_attr %} disabled selected{% endif %}>Select an Attribute</option>
		           	{% for verbose_attr, name_attr in attributes %}
				        <option value="{{ name_attr }}" {% if selected_attr == name_attr %}selected{% endif %}>{{ verbose_attr }}</option>
			        {% endfor %}
			        {% for verbose_attr, name_attr in attributes2 %}
				        <option value="{{ name_attr }}" {% if selected_attr == name_attr %}selected{% endif %}>{{ verbose_attr }}</option>
			        {% endfor %}
			        {% for verbose_attr, name_attr in attributes3 %}
				        <option value="{{ name_attr }}" {% if selected_attr == name_attr %}selected{% endif %}>{{ verbose_attr }}</option>
			        {% endfor %}
		        </select>
		    </div>
	    </form>
	</div>

	{% if selected_attr %}
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<div style="width: 80%; margin: auto;">
        	<canvas id="trendChart"></canvas>
    	</div>
	    <script>
	        // Retrieve data passed from Django view (converted into JSON format)
	        var trendData = JSON.parse('{{ trend_data_json|escapejs }}');  // Convert JSON to JS object

	        // Set up the chart data for Chart.js
	        var ctx = document.getElementById('trendChart').getContext('2d');
	        var trendChart = new Chart(ctx, {
	            type: 'line',  // Line chart
	            data: {
	                labels: trendData.years,  // X-axis: Years
	                datasets: [{
	                    label: trendData.school1_name,  // Dataset label
	                    data: trendData.values, // Y-axis: Trend values (value1)
	                    borderColor: 'rgba(75, 192, 192, 1)',  // Line color
	                    backgroundColor: 'rgba(75, 192, 192, 0.2)',  // Area under the line color
	                    fill: false,  // Fill the area under the line
	                    tension: 0.1  // Smooth curve
	                },
	                {
	                	label: trendData.school2_name,  // Dataset label
	                    data: trendData.values2, // Y-axis: Trend values (value1)
	                    borderColor: 'rgba(236, 100, 75, 1)',  // Line color
	                    backgroundColor: 'rgba(75, 192, 192, 0.2)',  // Area under the line color
	                    fill: false,  // Fill the area under the line
	                    tension: 0.1  // Smooth curve
	                }]
	            },
	            options: {
	                responsive: true,
	                scales: {
	                    x: {
	                        title: {
	                            display: true,
	                            text: 'Year'
	                        }
	                    },
	                    y: {
	                        title: {
	                            display: true,
	                            text: trendData.yLabel
	                        }
	                    }
	                }
	            }
	        });
	    </script>
	{% endif %}

	{% if selected_district and selected_district2 %}
		<br></br>
		{% if selected_school%}
			<h3>{{ selected_school }}</h3>
		{% else %}
			<h3>{{ selected_district }}</h3>
		{% endif %}
			{% if cat_info %}
				<h3>{{ table_name }}</h3>
				<div class="table-responsive">
					<table class="table table-striped">
			  			<thead class="thead-dark">
				    		<tr>
				    		{% for header in cat_headers %}
				    			<th scope="col">{{ header }}</th>
				    		{% endfor %}
				    		</tr>
			  			</thead>
				  		<tbody>
					  		{% if selected_year != 'all-years' %}
					  			<tr>
						  			{% for info in cat_info %}
						      			<td>{{ info }}</td>
						      		{% endfor %}
						    	</tr>
					  		{% else %}
					  			{% for info in cat_info %}
							  		<tr>
							  			{% for value in info.values %}
							      			<td>{{ value }}</td>
							      		{% endfor %}
							    	</tr>
								{% endfor %}
					  		{% endif %}
				  		</tbody>
					</table>
				</div>
			{% endif %}

			{% if cat_info2 %}
				<h3>{{ table_name2 }}</h3>
				<div class="table-responsive">
					<table class="table table-striped">
			  			<thead class="thead-dark">
				    		<tr>
				    			{% for header in cat_headers2 %}
				    				<th scope="col">{{ header }}</th>
				    			{% endfor %}
				    		</tr>
			  			</thead>
			  			<tbody>
			  				{% if selected_year != 'all-years' %}
			  					<tr>
				  					{% for info in cat_info2 %}
				      					<td>{{ info }}</td>
				      				{% endfor %}
				    			</tr>
			  				{% else %}
			  					{% for info in cat_info2 %}
					  				<tr>
					  					{% for value in info.values %}
					      					<td>{{ value }}</td>
					      				{% endfor %}
					    			</tr>
								{% endfor %}
			  				{% endif %}
			  			</tbody>
					</table>
				</div>
			{% endif %}

			{% if cat_info3 %}
				<h3>{{ table_name3 }}</h3>
				<div class="table-responsive">
					<table class="table table-striped">
					  <thead class="thead-dark">
						    <tr>
						    	{% for header in cat_headers3 %}
						    		<th scope="col">{{ header }}</th>
						    	{% endfor %}
						    </tr>
					  </thead>
					  <tbody>
					  	{% if selected_year != 'all-years' %}
					  		<tr>
						  		{% for info in cat_info3 %}
						      		<td>{{ info }}</td>
						      	{% endfor %}
						    </tr>
					  	{% else %}
					  		{% for info in cat_info3 %}
							  	<tr>
							  		{% for value in info.values %}
							      		<td>{{ value }}</td>
							      	{% endfor %}
							    </tr>
							{% endfor %}
					  	{% endif %}
					  </tbody>
					</table>
				</div>
			{% endif %}

			<br></br>
			{% if selected_school2%}
				<h3>{{ selected_school2 }}</h3>
			{% else %}
				<h3>{{ selected_district2 }}</h3>
			{% endif %}
			{% if cat_info_compare %}
				<h3>{{ table_name }}</h3>
				<div class="table-responsive">
					<table class="table table-striped">
			  			<thead class="thead-dark">
				    		<tr>
				    		{% for header in cat_headers_compare %}
				    			<th scope="col">{{ header }}</th>
				    		{% endfor %}
				    		</tr>
			  			</thead>
				  		<tbody>
					  		{% if selected_year != 'all-years' %}
					  			<tr>
						  			{% for info in cat_info_compare %}
						      			<td>{{ info }}</td>
						      		{% endfor %}
						    	</tr>
					  		{% else %}
					  			{% for info in cat_info_compare %}
							  		<tr>
							  			{% for value in info.values %}
							      			<td>{{ value }}</td>
							      		{% endfor %}
							    	</tr>
								{% endfor %}
					  		{% endif %}
				  		</tbody>
					</table>
				</div>
			{% endif %}

			{% if cat_info2_compare %}
				<h3>{{ table_name2 }}</h3>
				<div class="table-responsive">
					<table class="table table-striped">
			  			<thead class="thead-dark">
				    		<tr>
				    			{% for header in cat_headers2_compare %}
				    				<th scope="col">{{ header }}</th>
				    			{% endfor %}
				    		</tr>
			  			</thead>
			  			<tbody>
			  				{% if selected_year != 'all-years' %}
			  					<tr>
				  					{% for info in cat_info2_compare %}
				      					<td>{{ info }}</td>
				      				{% endfor %}
				    			</tr>
			  				{% else %}
			  					{% for info in cat_info2_compare %}
					  				<tr>
					  					{% for value in info.values %}
					      					<td>{{ value }}</td>
					      				{% endfor %}
					    			</tr>
								{% endfor %}
			  				{% endif %}
			  			</tbody>
					</table>
				</div>
			{% endif %}

			{% if cat_info3_compare %}
				<h3>{{ table_name3 }}</h3>
				<div class="table-responsive">
					<table class="table table-striped">
					  <thead class="thead-dark">
						    <tr>
						    	{% for header in cat_headers3_compare %}
						    		<th scope="col">{{ header }}</th>
						    	{% endfor %}
						    </tr>
					  </thead>
					  <tbody>
					  	{% if selected_year != 'all-years' %}
					  		<tr>
						  		{% for info in cat_info3_compare %}
						      		<td>{{ info }}</td>
						      	{% endfor %}
						    </tr>
					  	{% else %}
					  		{% for info in cat_info3_compare %}
							  	<tr>
							  		{% for value in info.values %}
							      		<td>{{ value }}</td>
							      	{% endfor %}
							    </tr>
							{% endfor %}
					  	{% endif %}
					  </tbody>
					</table>
				</div>
			{% endif %}
	{% endif %}

{% endblock %}