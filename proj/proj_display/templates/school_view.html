{% extends 'base.html' %}

{% block content %}

	<h1>School View for {{ school_info.school_name }}</h1>

	<br></br>

	<div class="container">
    
	    <form method="GET" action="{% url 'year_view_school' school_id=school_info.school_id %}">
	        <div class="form-group">
	            <label for="yearSelectSchool">Choose Year</label>
	            <select class="form-control" id="yearSelectSchool" name="yearSchool" onchange="this.form.submit()">
	            	<option value="all-years" {% if selected_year == 'all-years' %}selected{% endif %}>All Years</option>
	                <option value="20222023" {% if selected_year == '20222023' %}selected{% endif %}>2022-2023</option>
	                <option value="20212022" {% if selected_year == '20212022' %}selected{% endif %}>2021-2022</option>
	                <option value="20202021" {% if selected_year == '20202021' %}selected{% endif %}>2020-2021</option>
	            </select>
	        </div>
	    </form>
	</div>

	{% if fast_facts %}
	<br></br>
	<h3>Contact Information:</h3>
	<div class="table-responsive">
		<table class="table table-striped">
		  <thead class="thead-dark">
		    <tr>
		    	{% if selected_year == NULL or selected_year == 'all-years' %}
		    		<th scope="col">Year</th>
		    	{% endif %}
		      <th scope="col">Street</th>
		      <th scope="col">City</th>
		      <th scope="col">Zip Code</th>
		      <th scope="col">Website</th>
		      <th scope="col">Phone Number</th>
		      <th scope="col">Enrollment</th>
		    </tr>
		  </thead>
		  <tbody>
		  	{% for facts in fast_facts %}
		    <tr>
		    	{% if selected_year == NULL or selected_year == 'all-years' %}
		    		<td>{{ facts.year }}</td>
		    	{% endif %}
		      <td>{{ school_info2.street_address }}</td>
		      <td>{{ school_info2.city_address }}</td>
		      <td>{{ school_info2.zip_code }}</td>
		      <td>{{ school_info2.website }}</td>
		      <td>{{ school_info2.phone_num }}</td>
		      <td>{{ school_info2.enrollment }}</td>
		    </tr>
		    {% endfor %}
			</tbody>
		</table>

		<h3>Fast Facts:</h3>
	<div class="table-responsive">
		<table class="table table-striped">
		  <thead class="thead-dark">
		    <tr>
		    	{% if selected_year == NULL or selected_year == 'all-years' %}
		    		<th scope="col">Year</th>
		    	{% endif %}
		      <th scope="col">Total Enrollment</th>
		      <th scope="col">African American %</th>
		      <th scope="col">American Indian %</th>
		      <th scope="col">Asian %</th>
		      <th scope="col">Hispanic %</th>
		      <th scope="col">Pacific Islander %</th>
		      <th scope="col">White %</th>
		      <th scope="col">Two or More Races %</th>
		      <th scope="col">Foster Care %</th>
		      <th scope="col">Economically Disadvantaged %</th>
		      <th scope="col">English Learner %</th>
		      <th scope="col">Special Education %</th>
		      <th scope="col">Gifted Students %</th>
		    </tr>
		  </thead>
		  <tbody>
		  	{% for facts in fast_facts %}
		    <tr>
		    	{% if selected_year == NULL or selected_year == 'all-years' %}
		    		<td>{{ facts.school_year }}</td>
		    	{% endif %}
		      <td>{{ facts.enrollment }}</td>
		      <td>{{ facts.per_african_american }}</td>
		      <td>{{ facts.per_am_indian_or_alaskan_native }}</td>
		      <td>{{ facts.per_asian }}</td>
		      <td>{{ facts.per_hispanic }}</td>
		      <td>{{ facts.per_pacific_islander }}</td>
		      <td>{{ facts.per_white }}</td>
		      <td>{{ facts.per_two_or_more_races }}</td>
		      <td>{{ facts.foster_care }}</td>
		      <td>{{ facts.economically_disadvantaged }}</td>
		      <td>{{ facts.english_learner }}</td>
		      <td>{{ facts.special_education }}</td>
		      <td>{{ facts.gifted_students }}</td>
		    </tr>
		    {% endfor %}
		  </tbody>
		</table>
	</div>

		<div style="width: 300px; height: 300px;">
		<canvas id="chartjs-pie" ></canvas>
	</div>
		<script src="https://cdn.jsdelivr.net/npm/chart.js">

		</script>
		{% if selected_year != 'all-years' and selected_year != NULL and gender_facts %}
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
				//if not working add another {} to both male and female 
				var male={ gender_facts.male|default:0|};
				var female={ gender_facts.female|default:0|};

				new Chart(document.getElementById("chartjs-pie"), {
					type: "pie",
					data: {
						labels: ["Male", "Female"],
						datasets: [{
		
							//need to use selected_year to get gender from school by year 
							data: [male, female],
		
							backgroundColor: [
								"#007bff",  
								"#28a745"
							],
							borderColor: "transparent"
						}]
					},
					options: {
						maintainAspectRatio: false,
						cutoutPercentage: 65,
						responsive: true,
						scales:{
		
						}
					}
				});
			}); 
			
				</script>
				{% endif %}
			
		
			</div>
			{% endif %}
		
			
		{% endblock %}